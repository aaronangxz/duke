<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Runner.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">test.exec</a> &gt; <a href="index.source.html" class="el_package">duke.impl</a> &gt; <span class="el_source">Runner.java</span></div><h1>Runner.java</h1><pre class="source lang-java linenums">package duke.impl;

import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.nio.file.StandardCopyOption;
import java.time.Instant;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Comparator;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Scanner;

import duke.tasks.Deadline;
import duke.tasks.Event;
import duke.tasks.Task;
import duke.tasks.TaskList;
import duke.tasks.Todo;
import duke.utils.DateProcessor;
import duke.utils.DukeException;
import duke.utils.Encoder;

/**
 * Executor of actual processing logic.
 */
<span class="pc bpc" id="L30" title="1 of 2 branches missed.">public class Runner {</span>
    private static final String ARCHIVE_CACHE_DIR = &quot;data/tmp/&quot;;
    private static final String ARCHIVE_CACHE_FILE_PATH = &quot;data/tmp/archives&quot;;
    private static final String SAVED_DIR = &quot;data/save/&quot;;
    private static final String SAVED_FILE_PATH = &quot;data/save/output&quot;;
    private static final String ARCHIVE_DIR = &quot;data/archives/&quot;;

    /**
     * Enums of task related commands
     */
<span class="fc" id="L40">    public enum Command {</span>
<span class="fc" id="L41">        DEADLINE(&quot;deadline&quot;), EVENT(&quot;event&quot;),</span>

<span class="fc" id="L43">        DATE(&quot;date&quot;), TODO(&quot;todo&quot;);</span>

        public final String label;

<span class="fc" id="L47">        Command(String label) {</span>
<span class="fc" id="L48">            this.label = label;</span>
<span class="fc" id="L49">        }</span>

        public String getLabel() {
<span class="nc" id="L52">            return this.label;</span>
        }
    }

    /**
     * Enums of action related commands
     */
<span class="fc" id="L59">    public enum Action {</span>
<span class="fc" id="L60">        MARK(&quot;mark&quot;), UNMARK(&quot;unmark&quot;), DELETE(&quot;delete&quot;);</span>

        public final String label;

<span class="fc" id="L64">        Action(String label) {</span>
<span class="fc" id="L65">            this.label = label;</span>
<span class="fc" id="L66">        }</span>

        public String getLabel() {
<span class="nc" id="L69">            return this.label;</span>
        }
    }

    protected Ui ui;

    protected DateProcessor d;
    protected ArrayList&lt;Task&gt; arrayList;
<span class="fc" id="L77">    protected Map&lt;Integer, String&gt; fileMap = new HashMap&lt;&gt;();</span>

    /**
     * Initializes TaskList and IO of Runner object.
     *
     * @param a Task list to execute
     */
<span class="fc" id="L84">    public Runner(ArrayList&lt;Task&gt; a, Ui.LocaleRegion l) {</span>
<span class="fc" id="L85">        arrayList = a;</span>
<span class="pc bpc" id="L86" title="2 of 3 branches missed.">        switch (l) {</span>
        case CN:
<span class="nc" id="L88">            ui = new UiCn();</span>
<span class="nc" id="L89">            break;</span>
        case EN:
<span class="fc" id="L91">            ui = new UiEn();</span>
<span class="fc" id="L92">            break;</span>
        default:
        }
<span class="fc" id="L95">        d = new DateProcessor(l);</span>
<span class="fc" id="L96">    }</span>

    public String printList(Boolean withIndex) {
<span class="nc" id="L99">        return ui.printList(arrayList, withIndex);</span>
    }

    private String printSelectedList(ArrayList&lt;Task&gt; l, Boolean withIndex, String date) {
<span class="nc" id="L103">        return ui.printSelectedList(l, withIndex, date);</span>
    }

    private String printFoundList(ArrayList&lt;Task&gt; l, Boolean withIndex, String keyword) {
<span class="nc" id="L107">        return ui.printFoundList(l, withIndex, keyword);</span>
    }

    private String printSingle(int index, Boolean isMark) {
<span class="nc" id="L111">        return ui.printMarkTask(arrayList.get(index).toString(), isMark);</span>
    }

    private String printNewTaskAdded() {
<span class="fc" id="L115">        return ui.printNewTasks(arrayList.get(arrayList.size() - 1).toString(), arrayList.size());</span>
    }

    private String printTaskRemovedByIndex(Task t) {
<span class="nc" id="L119">        return ui.printTaskRemovedByIndex(t.toString(), arrayList.size());</span>
    }

    public String printHelpMessage() {
<span class="nc" id="L123">        return ui.sendHelpMessage();</span>
    }

    public String printExitMessage() {
<span class="nc" id="L127">        return ui.sendGoodbyeMessage();</span>
    }

    public String printCommandUnknownMessage() {
<span class="nc" id="L131">        return ui.sendCommandUnknownError();</span>
    }

    private String printProcessCommandMessage(String message) {
<span class="nc" id="L135">        return ui.sendProcessCommandError(message);</span>
    }

    private String printProcessActionMessage(String message) {
<span class="nc" id="L139">        return ui.sendProcessActionError(message);</span>
    }

    private String printProcessFindDateMessage() {
<span class="nc" id="L143">        return ui.sendProcessFindDateError();</span>
    }

    private String printProcessFindTaskMessage() {
<span class="nc" id="L147">        return ui.sendProcessFindTaskError();</span>
    }

    private String printProcessArchiveMessage() {
<span class="nc" id="L151">        return ui.printProcessArchiveMessage();</span>
    }

    private String printProcessArchiveFailureMessage() {
<span class="nc" id="L155">        return ui.printProcessArchiveFailureMessage();</span>
    }

    private String printProcessRestoreMessage() {
<span class="nc" id="L159">        return ui.printProcessRestoreMessage();</span>
    }

    private String printProcessRestoreFailureMessage() {
<span class="nc" id="L163">        return ui.sendProcessRestoreError();</span>
    }

    private String printIoException(String s) {
<span class="nc" id="L167">        return ui.sendGenericWarning(s);</span>
    }

    private String printListFilesHeaderMessage() {
<span class="nc" id="L171">        return ui.printListFilesHeaderMessage();</span>
    }

    private String printListFilesFooterMessage() {
<span class="nc" id="L175">        return ui.printListFilesFooterMessage();</span>
    }

    public static String getCurrentUserName() {
<span class="fc" id="L179">        return System.getProperty(&quot;user.name&quot;);</span>
    }

    private long getCurrentTimeStamp() {
<span class="fc" id="L183">        return Instant.now().getEpochSecond();</span>
    }

    private int getIndex(String s) throws DukeException {
        try {
<span class="nc bnc" id="L188" title="All 2 branches missed.">            if (!isInteger(s)) {</span>
<span class="nc" id="L189">                return -1;</span>
            }
<span class="nc" id="L191">        } catch (DukeException e) {</span>
<span class="nc" id="L192">            throw new DukeException(e.getMessage());</span>
<span class="nc" id="L193">        }</span>

<span class="nc" id="L195">        int i = Integer.parseInt(s) - 1;</span>
<span class="nc bnc" id="L196" title="All 4 branches missed.">        if (i &lt; 0 || i &gt;= this.arrayList.size()) {</span>
<span class="nc" id="L197">            throw new DukeException(ui.printGetIndexErrorMessage(this.arrayList.size()));</span>
        }
<span class="nc" id="L199">        return i;</span>
    }

    private int getArchiveIndex(String s) throws DukeException, IOException {
        try {
<span class="nc bnc" id="L204" title="All 2 branches missed.">            if (!isInteger(s)) {</span>
<span class="nc" id="L205">                return -1;</span>
            }
<span class="nc" id="L207">        } catch (DukeException e) {</span>
<span class="nc" id="L208">            throw new DukeException(e.getMessage());</span>
<span class="nc" id="L209">        }</span>

<span class="nc" id="L211">        int archiveSize = getArchiveSize();</span>

<span class="nc bnc" id="L213" title="All 2 branches missed.">        if (archiveSize &lt;= 0) {</span>
<span class="nc" id="L214">            throw new DukeException(ui.printNoArchiveFileFoundError());</span>
        }

<span class="nc" id="L217">        int i = Integer.parseInt(s);</span>
<span class="nc bnc" id="L218" title="All 4 branches missed.">        if (i &lt; 0 || i &gt;= archiveSize) {</span>
<span class="nc" id="L219">            throw new DukeException(ui.printGetArchiveIndexErrorMessage(archiveSize));</span>
        }
<span class="nc" id="L221">        return i;</span>
    }

    private boolean isInteger(String s) throws DukeException {
        try {
<span class="nc" id="L226">            Integer.parseInt(s);</span>
<span class="nc" id="L227">            return true;</span>
<span class="nc" id="L228">        } catch (NumberFormatException | NullPointerException e) {</span>
<span class="nc" id="L229">            throw new DukeException(ui.printIsIntegerErrorMessage());</span>
        }
    }

    protected String processAction(Action a, String[] s) {
<span class="nc bnc" id="L234" title="All 2 branches missed.">        if (s.length == 1) {</span>
<span class="nc" id="L235">            return printProcessActionMessage(a.getLabel());</span>
        }

        int idx;
        try {
<span class="nc" id="L240">            idx = getIndex(s[1]);</span>
<span class="nc" id="L241">        } catch (DukeException e) {</span>
<span class="nc" id="L242">            return e.getMessage();</span>
<span class="nc" id="L243">        }</span>

<span class="nc bnc" id="L245" title="All 2 branches missed.">        if (idx != -1) {</span>
<span class="nc bnc" id="L246" title="All 4 branches missed.">            switch (a) {</span>
            case MARK:
<span class="nc" id="L248">                arrayList.get(idx).markTask();</span>
                try {
<span class="nc" id="L250">                    saveFile();</span>
<span class="nc" id="L251">                    return printSingle(idx, true);</span>
<span class="nc" id="L252">                } catch (IOException e) {</span>
<span class="nc" id="L253">                    return printIoException(e.getMessage());</span>
                }
            case UNMARK:
<span class="nc" id="L256">                arrayList.get(idx).unmarkTask();</span>
                try {
<span class="nc" id="L258">                    saveFile();</span>
<span class="nc" id="L259">                    return printSingle(idx, false);</span>
<span class="nc" id="L260">                } catch (IOException e) {</span>
<span class="nc" id="L261">                    return printIoException(e.getMessage());</span>
                }
            case DELETE:
<span class="nc" id="L264">                Task copy = arrayList.get(idx);</span>
<span class="nc" id="L265">                arrayList.remove(idx);</span>
                try {
<span class="nc" id="L267">                    saveFile();</span>
<span class="nc" id="L268">                    return printTaskRemovedByIndex(copy);</span>
<span class="nc" id="L269">                } catch (IOException e) {</span>
<span class="nc" id="L270">                    return printIoException(e.getMessage());</span>
                }
            default:
<span class="nc" id="L273">                return (ui.printUnknownCommandErrorMessage());</span>
            }
        }
<span class="nc" id="L276">        return &quot;&quot;;</span>
    }

    protected void processDue(Command c, String[] s) throws DukeException {
        long convertedTime;

<span class="pc bpc" id="L282" title="3 of 4 branches missed.">        switch (c) {</span>
        case EVENT:
<span class="nc" id="L284">            String[] eventByInput = s[1].split(&quot;/at&quot;, 2);</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">            if (eventByInput.length == 1) {</span>
<span class="nc" id="L286">                arrayList.add(new Event(eventByInput[0].trim(), new long[]{}));</span>
            } else {
                long[] convertedTimeRange;
                try {
<span class="nc" id="L290">                    convertedTimeRange = d.processDateTimeRange(eventByInput[1].trim());</span>
<span class="nc" id="L291">                } catch (DukeException e) {</span>
<span class="nc" id="L292">                    throw new DukeException(e.getMessage());</span>
<span class="nc" id="L293">                }</span>
<span class="nc bnc" id="L294" title="All 2 branches missed.">                if (convertedTimeRange == null) {</span>
<span class="nc" id="L295">                    throw new DukeException(&quot;&quot;);</span>
                }
<span class="nc" id="L297">                arrayList.add(new Event(eventByInput[0].trim(), convertedTimeRange));</span>
            }
<span class="nc" id="L299">            break;</span>
        case DEADLINE:
<span class="nc" id="L301">            String[] deadlineByInput = s[1].split(&quot;/by&quot;, 2);</span>
<span class="nc bnc" id="L302" title="All 2 branches missed.">            if (deadlineByInput.length == 1) {</span>
<span class="nc" id="L303">                arrayList.add(new Deadline(deadlineByInput[0].trim(), 0));</span>
            } else {
                try {
<span class="nc" id="L306">                    convertedTime = d.processDateTime(deadlineByInput[1].trim());</span>
<span class="nc" id="L307">                } catch (DukeException e) {</span>
<span class="nc" id="L308">                    throw new DukeException(e.getMessage());</span>
<span class="nc" id="L309">                }</span>
<span class="nc bnc" id="L310" title="All 2 branches missed.">                if (convertedTime == -1) {</span>
<span class="nc" id="L311">                    throw new DukeException(&quot;&quot;);</span>
                }
<span class="nc" id="L313">                arrayList.add(new Deadline(deadlineByInput[0].trim(), convertedTime));</span>
            }
<span class="nc" id="L315">            break;</span>
        case TODO:
<span class="fc" id="L317">            String[] todoByInput = s[1].split(&quot;/by&quot;, 2);</span>
<span class="pc bpc" id="L318" title="1 of 2 branches missed.">            if (todoByInput.length == 1) {</span>
<span class="fc" id="L319">                arrayList.add(new Todo(todoByInput[0].trim(), 0));</span>
            } else {
                try {
<span class="nc" id="L322">                    convertedTime = d.processDateTime(todoByInput[1].trim());</span>
<span class="nc" id="L323">                } catch (DukeException e) {</span>
<span class="nc" id="L324">                    throw new DukeException(e.getMessage());</span>
<span class="nc" id="L325">                }</span>
<span class="nc bnc" id="L326" title="All 2 branches missed.">                if (convertedTime == -1) {</span>
<span class="nc" id="L327">                    throw new DukeException(&quot;&quot;);</span>
                }
<span class="nc" id="L329">                arrayList.add(new Todo(todoByInput[0].trim(), convertedTime));</span>
            }
<span class="nc" id="L331">            break;</span>
        default:
<span class="nc" id="L333">            throw new DukeException(ui.printUnknownCommandErrorMessage());</span>
        }
<span class="fc" id="L335">    }</span>

    protected String processAddTask(Command c, String[] s) {
<span class="pc bpc" id="L338" title="1 of 2 branches missed.">        if (s.length == 1) {</span>
<span class="nc" id="L339">            return printProcessCommandMessage(c.getLabel());</span>
        }

<span class="pc bpc" id="L342" title="1 of 2 branches missed.">        if (s[1].trim().equals(&quot;&quot;)) {</span>
<span class="nc" id="L343">            return printProcessCommandMessage(c.getLabel());</span>
        }

        try {
<span class="fc" id="L347">            processDue(c, s);</span>
<span class="nc" id="L348">        } catch (DukeException e) {</span>
<span class="nc" id="L349">            return e.getMessage();</span>
<span class="fc" id="L350">        }</span>

        try {
<span class="fc" id="L353">            saveFile();</span>
<span class="nc" id="L354">        } catch (IOException e) {</span>
<span class="nc" id="L355">            return printIoException(e.getMessage());</span>
<span class="fc" id="L356">        }</span>
<span class="fc" id="L357">        return printNewTaskAdded();</span>
    }

    private void restoreFile(int selection) throws IOException {
<span class="nc" id="L361">        String path = &quot;&quot;;</span>
<span class="nc" id="L362">        Files.createDirectories(Paths.get(ARCHIVE_CACHE_DIR));</span>
<span class="nc" id="L363">        Scanner scn = new Scanner(new File(ARCHIVE_CACHE_FILE_PATH));</span>
<span class="nc bnc" id="L364" title="All 4 branches missed.">        while (selection &gt; 0 &amp;&amp; scn.hasNext()) {</span>
<span class="nc" id="L365">            path = scn.nextLine();</span>
<span class="nc" id="L366">            selection--;</span>
        }
<span class="nc" id="L368">        Files.createDirectories(Paths.get(ARCHIVE_DIR));</span>
<span class="nc" id="L369">        Files.createDirectories(Paths.get(SAVED_DIR));</span>
<span class="nc" id="L370">        File fileToMove = new File(ARCHIVE_DIR + path);</span>
<span class="nc" id="L371">        File toReplace = new File(SAVED_FILE_PATH);</span>
<span class="nc" id="L372">        Files.copy(fileToMove.toPath(), toReplace.toPath(), StandardCopyOption.REPLACE_EXISTING);</span>
<span class="nc" id="L373">        new TaskList(new Scanner(new File(toReplace.toString())));</span>
<span class="nc" id="L374">    }</span>

    private boolean archiveFile() throws IOException {
<span class="nc" id="L377">        String archiveFileName = &quot;archive_&quot; + getCurrentUserName() + &quot;_&quot; + getCurrentTimeStamp();</span>
<span class="nc" id="L378">        File fileToMove = new File(SAVED_FILE_PATH);</span>
<span class="nc" id="L379">        saveFile();</span>
<span class="nc" id="L380">        Files.createDirectories(Paths.get(ARCHIVE_DIR));</span>
<span class="nc" id="L381">        return fileToMove.renameTo(new File(ARCHIVE_DIR, archiveFileName));</span>
    }

    private void saveFile() throws IOException {
<span class="fc" id="L385">        Files.createDirectories(Paths.get(SAVED_DIR));</span>
<span class="fc" id="L386">        FileWriter writer = new FileWriter(SAVED_FILE_PATH);</span>
<span class="fc" id="L387">        writer.write(getCurrentUserName() + System.lineSeparator());</span>
<span class="fc" id="L388">        writer.write(getCurrentTimeStamp() + System.lineSeparator());</span>

<span class="fc bfc" id="L390" title="All 2 branches covered.">        for (Task str : arrayList) {</span>
<span class="fc" id="L391">            String s = str.getType()</span>
<span class="fc" id="L392">                    + &quot;,&quot; + str.getIsDone()</span>
<span class="fc" id="L393">                    + &quot;,&quot; + str.getDescription()</span>
<span class="fc" id="L394">                    + &quot;,&quot; + str.getDue()</span>
<span class="fc" id="L395">                    + &quot;,&quot; + str.getTo();</span>
<span class="fc" id="L396">            writer.write(Encoder.encode(s) + System.lineSeparator());</span>
<span class="fc" id="L397">        }</span>
<span class="fc" id="L398">        writer.close();</span>
<span class="fc" id="L399">    }</span>

    private void cacheFile() throws IOException {
<span class="nc" id="L402">        Files.createDirectories(Paths.get(ARCHIVE_CACHE_DIR));</span>
<span class="nc" id="L403">        FileWriter writer = new FileWriter(ARCHIVE_CACHE_FILE_PATH);</span>

<span class="nc bnc" id="L405" title="All 2 branches missed.">        for (Map.Entry&lt;Integer, String&gt; m : fileMap.entrySet()) {</span>
<span class="nc" id="L406">            String s = m.getValue();</span>
<span class="nc" id="L407">            writer.write(s + System.lineSeparator());</span>
<span class="nc" id="L408">        }</span>
<span class="nc" id="L409">        writer.close();</span>
<span class="nc" id="L410">        File f = new File(ARCHIVE_CACHE_FILE_PATH);</span>
<span class="nc" id="L411">        f.deleteOnExit();</span>
<span class="nc" id="L412">    }</span>


    private long checkFindDate(String[] s) throws DukeException {
<span class="nc bnc" id="L416" title="All 2 branches missed.">        if (s.length == 1) {</span>
<span class="nc" id="L417">            throw new DukeException(printProcessFindDateMessage());</span>
        }

<span class="nc bnc" id="L420" title="All 2 branches missed.">        if (s[1].trim().equals(&quot;&quot;)) {</span>
<span class="nc" id="L421">            throw new DukeException(printProcessFindDateMessage());</span>
        }

        try {
<span class="nc" id="L425">            return d.processDate(s[1]);</span>
<span class="nc" id="L426">        } catch (DukeException e) {</span>
<span class="nc" id="L427">            throw new DukeException(e.getMessage());</span>
        }
    }

    protected String processFindDate(String[] s) {
        long d;

        try {
<span class="nc" id="L435">            d = checkFindDate(s);</span>
<span class="nc" id="L436">        } catch (DukeException e) {</span>
<span class="nc" id="L437">            return e.getMessage();</span>
<span class="nc" id="L438">        }</span>

<span class="nc" id="L440">        ArrayList&lt;Task&gt; selected = new ArrayList&lt;&gt;(List.of());</span>

<span class="nc bnc" id="L442" title="All 2 branches missed.">        for (Task t : this.arrayList) {</span>
<span class="nc bnc" id="L443" title="All 4 branches missed.">            if (t.getDue() &gt;= d &amp;&amp; t.getDue() &lt;= d + 86400) {</span>
<span class="nc" id="L444">                selected.add(t);</span>
            }
<span class="nc" id="L446">        }</span>
<span class="nc" id="L447">        selected.sort(new TaskComparator());</span>
<span class="nc" id="L448">        return printSelectedList(selected, true, s[1]);</span>
    }

<span class="nc" id="L451">    static class TaskComparator implements Comparator&lt;Task&gt; {</span>
        public int compare(Task t1, Task t2) {
<span class="nc" id="L453">            return Long.compare(t1.getDue(), t2.getDue());</span>
        }
    }

    private String checkFindTask(String[] s) throws DukeException {
<span class="nc bnc" id="L458" title="All 2 branches missed.">        if (s.length == 1) {</span>
<span class="nc" id="L459">            throw new DukeException(printProcessFindTaskMessage());</span>
        }

<span class="nc bnc" id="L462" title="All 2 branches missed.">        if (s[1].trim().equals(&quot;&quot;)) {</span>
<span class="nc" id="L463">            throw new DukeException(printProcessFindTaskMessage());</span>
        }
<span class="nc" id="L465">        return s[1];</span>
    }

    protected String processFindTask(String[] s) {
        String k;

        try {
<span class="nc" id="L472">            k = checkFindTask(s);</span>
<span class="nc" id="L473">        } catch (DukeException e) {</span>
<span class="nc" id="L474">            return e.getMessage();</span>
<span class="nc" id="L475">        }</span>

<span class="nc" id="L477">        ArrayList&lt;Task&gt; selected = new ArrayList&lt;&gt;(List.of());</span>

<span class="nc bnc" id="L479" title="All 2 branches missed.">        for (Task t : this.arrayList) {</span>
<span class="nc bnc" id="L480" title="All 2 branches missed.">            if (Arrays.asList(t.getDescription().toLowerCase().split(&quot; &quot;)).contains(k.toLowerCase())) {</span>
<span class="nc" id="L481">                selected.add(t);</span>
            }
<span class="nc" id="L483">        }</span>
<span class="nc" id="L484">        return printFoundList(selected, true, s[1]);</span>
    }

    protected String processArchive() {
        try {
<span class="nc bnc" id="L489" title="All 2 branches missed.">            if (archiveFile()) {</span>
<span class="nc" id="L490">                arrayList.clear();</span>
<span class="nc" id="L491">                return printProcessArchiveMessage();</span>
            }
<span class="nc" id="L493">        } catch (IOException e) {</span>
<span class="nc" id="L494">            return printIoException(e.getMessage());</span>
<span class="nc" id="L495">        }</span>
<span class="nc" id="L496">        return printProcessArchiveFailureMessage();</span>
    }

    private long translateFileNameToDateTime(String fileName) {
<span class="nc" id="L500">        String[] parsedFileName = fileName.split(&quot;_&quot;, 3);</span>
<span class="nc" id="L501">        String[] parsedFileDate = parsedFileName[2].split(&quot;\\.&quot;, 2);</span>
<span class="nc" id="L502">        return Long.parseLong(parsedFileDate[0]);</span>
    }

    private String listFiles() throws IOException {
<span class="nc" id="L506">        Files.createDirectories(Paths.get(ARCHIVE_DIR));</span>
<span class="nc" id="L507">        File[] listOfFiles = new File(ARCHIVE_DIR).listFiles();</span>
<span class="nc bnc" id="L508" title="All 4 branches missed.">        assert listOfFiles != null : ui.printNoArchiveFileFoundError();</span>

<span class="nc bnc" id="L510" title="All 4 branches missed.">        if (listOfFiles.length == 0</span>
<span class="nc bnc" id="L511" title="All 2 branches missed.">                || (listOfFiles.length == 1 &amp;&amp; listOfFiles[0].getName().equals(&quot;.gitkeep&quot;))) {</span>
<span class="nc" id="L512">            return ui.printNoArchiveFileFoundError();</span>
        }

<span class="nc" id="L515">        int i = 1;</span>
<span class="nc" id="L516">        StringBuilder s = new StringBuilder();</span>
<span class="nc" id="L517">        s.append(printListFilesHeaderMessage());</span>
<span class="nc bnc" id="L518" title="All 2 branches missed.">        for (File listOfFile : listOfFiles) {</span>
<span class="nc bnc" id="L519" title="All 4 branches missed.">            if (listOfFile.isFile() &amp;&amp; !listOfFile.getName().equals(&quot;.gitkeep&quot;)) {</span>
<span class="nc" id="L520">                this.fileMap.put(i, listOfFile.getName());</span>
<span class="nc" id="L521">                s.append(ui</span>
<span class="nc" id="L522">                        .sendGenericPlain(i + &quot;. &quot;</span>
<span class="nc" id="L523">                                + d.unixToString(translateFileNameToDateTime(listOfFile.getName()))));</span>
<span class="nc" id="L524">                i++;</span>
            }
        }
<span class="nc" id="L527">        s.append(printListFilesFooterMessage());</span>

        try {
<span class="nc" id="L530">            cacheFile();</span>
<span class="nc" id="L531">        } catch (IOException e) {</span>
<span class="nc" id="L532">            return printIoException(e.getMessage());</span>
<span class="nc" id="L533">        }</span>
<span class="nc" id="L534">        return String.valueOf(s);</span>
    }

    private int getArchiveSize() throws IOException {
<span class="nc" id="L538">        Files.createDirectories(Paths.get(ARCHIVE_DIR));</span>
<span class="nc" id="L539">        File[] listOfFiles = new File(ARCHIVE_DIR).listFiles();</span>
<span class="nc bnc" id="L540" title="All 4 branches missed.">        assert listOfFiles != null : ui.printNoArchiveFileFoundError();</span>
<span class="nc" id="L541">        return listOfFiles.length - 1;</span>
    }

    protected String processRestore(String[] s) {
<span class="nc bnc" id="L545" title="All 4 branches missed.">        assert s != null : ui.printProcessRestoreErrorMessage();</span>
        try {
<span class="nc bnc" id="L547" title="All 2 branches missed.">            if (s.length == 1) {</span>
<span class="nc" id="L548">                return listFiles();</span>
            }
<span class="nc" id="L550">        } catch (IOException e) {</span>
<span class="nc" id="L551">            return ui.printProcessRestoreErrorMessage();</span>
<span class="nc" id="L552">        }</span>

<span class="nc bnc" id="L554" title="All 2 branches missed.">        if (s[1].trim().equals(&quot;&quot;)) {</span>
<span class="nc" id="L555">            return printProcessRestoreFailureMessage();</span>
        }

        int idx;
        try {
<span class="nc" id="L560">            idx = getArchiveIndex(s[1]);</span>
<span class="nc" id="L561">        } catch (DukeException | IOException e) {</span>
<span class="nc" id="L562">            return e.getMessage();</span>
<span class="nc" id="L563">        }</span>

        try {
<span class="nc" id="L566">            restoreFile(idx);</span>
<span class="nc" id="L567">            return printProcessRestoreMessage();</span>
<span class="nc" id="L568">        } catch (IOException e) {</span>
<span class="nc" id="L569">            return ui.printProcessRestoreNoRecordMessage(e.getMessage());</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>